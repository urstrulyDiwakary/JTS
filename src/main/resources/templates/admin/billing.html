<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/jts-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/jts-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicons/jts-48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicons/jts-64.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/jts-96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/favicons/jts-128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/jts-192.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/favicons/jts-256.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicons/jts-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180.png">
    <!-- Fallback -->
    <link rel="icon" type="image/png" href="/jts.png" />

    <title>Billing - Jesta Tech Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2563eb; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --light-bg: #f3f4f6; --sidebar-bg: #4169E1; --hover-bg: #1e40af; --text-light: #ffffff; --text-dark: #1f2937; --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { height: 100%; }
        body { font-family: var(--font-family); background: var(--light-bg); height: 100%; }
        .sidebar { position: fixed; left: 0; top: 0; height: 100vh; width: 260px; background: var(--sidebar-bg); padding: 20px 0; transition: 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { display: flex; align-items: center; justify-content: space-between; padding: 0 20px 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .logo { display: flex; align-items: center; gap: 12px; color: var(--text-light); font-size: 1.3rem; font-weight: 700; font-family: var(--font-family); white-space: nowrap; }
        .logo i { font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; justify-content: center; }
        .toggle-btn { background: none; border: none; color: var(--text-light); font-size: 1.2rem; cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; }
        .toggle-btn:hover { background: rgba(255,255,255,0.1); transform: scale(1.05); }
        .toggle-btn i { font-size: 1.2rem; }
        .nav-menu { list-style: none; padding: 15px 0; flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .nav-link { display: flex; align-items: center; gap: 15px; padding: 14px 20px; color: rgba(255,255,255,0.7); text-decoration: none; transition: 0.3s; font-size: 0.95rem; font-family: var(--font-family); margin: 0 10px; border-radius: 6px; font-weight: 500; }
        .nav-link:hover { background: var(--hover-bg); color: var(--text-light); }
        .nav-link.active { background: var(--hover-bg); color: var(--text-light); border-left: 4px solid var(--primary); padding-left: 16px; }
        .nav-link i { font-size: 1.1rem; width: 20px; text-align: center; display: flex; align-items: center; justify-content: center; }
        .main-content { margin-left: 260px; transition: 0.3s; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { background: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; flex-shrink: 0; gap: 20px; }
        .user-profile { display: flex; align-items: center; gap: 12px; cursor: pointer; position: relative; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; }
        .user-info h4 { font-size: 0.9rem; margin-bottom: 2px; }
        .user-info p { font-size: 0.75rem; color: #6b7280; }
        .profile-dropdown { position: absolute; top: 100%; right: 0; margin-top: 10px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .profile-dropdown.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .profile-dropdown::before { content: ''; position: absolute; top: -6px; right: 20px; width: 12px; height: 12px; background: white; transform: rotate(45deg); box-shadow: -2px -2px 4px rgba(0,0,0,0.05); }
        .dropdown-header { padding: 15px; border-bottom: 1px solid #e5e7eb; }
        .dropdown-header h4 { font-size: 0.95rem; margin-bottom: 3px; }
        .dropdown-header p { font-size: 0.8rem; color: #6b7280; }
        .dropdown-menu { list-style: none; padding: 8px 0; }
        .dropdown-menu li { padding: 0; }
        .dropdown-menu button { display: flex; align-items: center; gap: 12px; width: 100%; padding: 12px 15px; text-decoration: none; color: #1f2937; border: none; background: none; cursor: pointer; font-size: 0.9rem; transition: background 0.2s ease; text-align: left; }
        .dropdown-menu button:hover { background: #f3f4f6; }
        .dropdown-menu i { width: 18px; font-size: 1rem; color: #6b7280; }
        .dropdown-menu .logout-btn { color: #ef4444; }
        .dropdown-menu .logout-btn i { color: #ef4444; }
        .content { padding: 30px; }
        .page-header { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .page-title h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .breadcrumb { color: #6b7280; font-size: 0.9rem; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37,99,235,0.3); }
        .billing-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .summary-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .summary-card h3 { font-size: 2rem; margin-bottom: 5px; }
        .summary-card p { color: #6b7280; }
        .summary-card .icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
        .invoices-table { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow-x: auto; }
        .invoices-table h2 { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: var(--light-bg); }
        th { padding: 15px; text-align: left; font-weight: 600; color: #6b7280; font-size: 0.9rem; }
        td { padding: 15px; border-bottom: 1px solid #e5e7eb; }
        tbody tr:hover { background: var(--light-bg); }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-paid { background: rgba(16,185,129,0.1); color: var(--success); }
        .status-pending { background: rgba(245,158,11,0.1); color: var(--warning); }
        .status-overdue { background: rgba(239,68,68,0.1); color: var(--danger); }
        .search-bar { display:flex; align-items:center; background: var(--light-bg); padding: 10px 20px; border-radius: 8px; width: 400px; }
        .search-bar i { color:#6b7280; }
        .search-bar input { border:none; background:none; outline:none; width:100%; margin-left:10px; }
        .header-actions { display:flex; gap:10px; align-items:center; }
        .filter-group select { padding:10px 14px; border:1px solid #e5e7eb; border-radius:8px; }
        .btn-secondary { background:#fff; color:#1f2937; border:2px solid #e5e7eb; }
        .btn-secondary:hover { background: var(--light-bg); }
        .pagination { display:flex; gap:6px; align-items:center; justify-content:flex-end; padding-top:12px; }
        .page-btn { padding:8px 12px; border:1px solid #e5e7eb; background:#fff; border-radius:6px; cursor:pointer; }
        .page-btn.active { background: var(--primary); color:#fff; border-color: var(--primary); }
        .action-btn { padding:6px 10px; border:1px solid #e5e7eb; background:#fff; border-radius:6px; cursor:pointer; }
        .action-btn:hover { background: var(--light-bg); }

        /* Invoice Filters Styles */
        .invoice-filters {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 120px;
        }

        .filter-item label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .filter-item input, .filter-item select {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
            background: white;
        }

        .filter-item input:focus, .filter-item select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
        }

        .filter-actions {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        .filter-actions .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .filter-actions .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        /* Responsive Design for Filters */
        @media (max-width: 1200px) {
            .invoice-filters {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .invoice-filters > div {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .filter-actions {
                justify-content: flex-end;
                margin-top: 10px;
            }
        }

        @media (max-width: 768px) {
            .invoice-filters > div {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-actions {
                justify-content: center;
            }
        }
    </style>

    <!-- Modern Header CSS -->
    <link rel="stylesheet" href="/css/admin-header-modern.css">

    <!-- Mobile Navigation CSS -->
    <link rel="stylesheet" href="/css/admin-mobile-nav.css">
</head>
<body>
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="logo"><span>Jesta Tech Solutions</span></div>
        <button class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    </div>
    <ul class="nav-menu">
        <li><a href="/admin/dashboard" class="nav-link"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
        <li><a href="/admin/forms" class="nav-link"><i class="fas fa-list-check"></i><span>Forms</span></a></li>
        <li><a href="/admin/projects" class="nav-link"><i class="fas fa-project-diagram"></i><span>Projects</span></a></li>
        <li><a href="/admin/tasks" class="nav-link"><i class="fas fa-tasks"></i><span>Tasks</span></a></li>
        <li><a href="/admin/analytics" class="nav-link"><i class="fas fa-chart-line"></i><span>Analytics</span></a></li>
        <li><a href="/admin/billing" class="nav-link active"><i class="fas fa-file-invoice-dollar"></i><span>Billing</span></a></li>
        <li><a href="/admin/users" class="nav-link"><i class="fas fa-users"></i><span>Users</span></a></li>
    </ul>
</aside>

<main class="main-content" id="mainContent">
    <div class="top-bar">
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search invoices...">
        </div>
        <div style="display: flex; align-items: center; gap: 25px;">
            <i class="fas fa-bell" style="font-size: 1.3rem; color: #1f2937; cursor: pointer;" title="Notifications"></i>
            <i class="fas fa-cog" onclick="window.location.href='/admin/settings'" style="font-size: 1.3rem; color: #1f2937; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.color='#2563eb'; this.style.transform='rotate(90deg)'" onmouseout="this.style.color='#1f2937'; this.style.transform='rotate(0deg)'" title="Settings"></i>
            <div class="user-profile" id="userProfileBtn">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="userName">User</h4>
                    <p id="userRole">Role</p>
                </div>
                <i class="fas fa-chevron-down"></i>
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="dropdown-header">
                        <h4 id="dropdownUserName">User</h4>
                        <p id="dropdownUserEmail">user@example.com</p>
                    </div>
                    <ul class="dropdown-menu">
                        <li>
                            <button onclick="handleLogout()" class="logout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="page-header">
            <div class="page-title"><h1>Billing Dashboard</h1><p class="breadcrumb">Home / Billing</p></div>
            <div class="header-actions">
                <button class="btn btn-secondary"><i class="fas fa-file-export"></i>Export</button>
                <button class="btn btn-primary" onclick="openAddBillingModal()"><i class="fas fa-plus"></i>Create Invoice</button>
            </div>
        </div>

        <div class="billing-summary">
            <div class="summary-card">
                <div class="icon" style="background: rgba(37,99,235,0.1); color: var(--primary);"><i class="fas fa-rupee-sign"></i></div>
                <h3 id="totalRevenue">₹0</h3>
                <p>Total Revenue</p>
            </div>
            <div class="summary-card">
                <div class="icon" style="background: rgba(16,185,129,0.1); color: var(--success);"><i class="fas fa-check-circle"></i></div>
                <h3 id="paidAmount">₹0</h3>
                <p>Paid Invoices</p>
            </div>
            <div class="summary-card">
                <div class="icon" style="background: rgba(245,158,11,0.1); color: var(--warning);"><i class="fas fa-clock"></i></div>
                <h3 id="pendingAmount">₹0</h3>
                <p>Pending Payment</p>
            </div>
            <div class="summary-card">
                <div class="icon" style="background: rgba(239,68,68,0.1); color: var(--danger);"><i class="fas fa-exclamation-circle"></i></div>
                <h3 id="overdueAmount">₹0</h3>
                <p>Overdue</p>
            </div>
        </div>

        <div class="invoices-table">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Recent Invoices</h2>
                <div class="invoice-filters" style="display: flex; gap: 15px; align-items: center;">
                    <div class="filter-item">
                        <label style="font-size: 0.85rem; color: #6b7280; margin-bottom: 5px; display: block;">Client Name</label>
                        <input type="text" id="clientFilter" placeholder="Search client..." style="padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem; width: 150px;">
                    </div>
                    <div class="filter-item">
                        <label style="font-size: 0.85rem; color: #6b7280; margin-bottom: 5px; display: block;">Status</label>
                        <select id="statusFilter" style="padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem; width: 120px;">
                            <option value="">All Status</option>
                            <option value="PAID">Paid</option>
                            <option value="PENDING">Pending</option>
                            <option value="OVERDUE">Overdue</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label style="font-size: 0.85rem; color: #6b7280; margin-bottom: 5px; display: block;">Due Date</label>
                        <input type="date" id="dueDateFilter" style="padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem; width: 140px;">
                    </div>
                    <div class="filter-item">
                        <label style="font-size: 0.85rem; color: #6b7280; margin-bottom: 5px; display: block;">Paid Date</label>
                        <input type="date" id="paidDateFilter" style="padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9rem; width: 140px;">
                    </div>
                    <div class="filter-actions" style="margin-top: 20px;">
                        <button onclick="applyFilters()" class="btn" style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer; margin-right: 8px;">
                            <i class="fas fa-filter"></i> Apply
                        </button>
                        <button onclick="clearFilters()" class="btn" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </div>
            <table class="billing-table">
                <thead>
                <tr>
                    <th>Invoice #</th>
                    <th>Client</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Due Date</th>
                    <th>Paid Date</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <!-- dynamically rendered -->
                </tbody>
            </table>
            <div class="pagination"></div>
        </div>
    </div>
</main>

<!-- Add/Edit Billing Modal -->
<div class="modal" id="billingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="modal-content" style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h2>Add New Invoice</h2>
            <button class="close-btn" onclick="closeModal('billingModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
        </div>
        <form>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Invoice Number *</label>
                <input type="text" name="invoiceNumber" placeholder="Enter invoice number" required style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem;">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Client Name *</label>
                <input type="text" name="clientName" placeholder="Enter client name" required style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem;">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Amount (₹) *</label>
                <input type="number" name="amount" placeholder="Enter amount" required style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem;">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Due Date *</label>
                <input type="date" name="dueDate" required style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem;">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Status *</label>
                <select name="status" required style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem;">
                    <option value="PENDING">Pending</option>
                    <option value="PAID">Paid</option>
                    <option value="OVERDUE">Overdue</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Notes</label>
                <textarea name="notes" placeholder="Enter notes" style="width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem; resize: vertical; min-height: 80px;"></textarea>
            </div>
            <div class="form-actions" style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('billingModal')" style="padding: 12px 24px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; background: white; color: #1f2937;">Cancel</button>
                <button type="submit" class="btn btn-primary" style="padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; background: #2563eb; color: white;">Add Invoice</button>
            </div>
        </form>
    </div>
</div>

<style>
.modal.active { display: flex !important; }
</style>

<!-- Mobile Bottom Navigation -->
<nav class="bottom-nav">
    <ul class="bottom-nav-menu">
        <li class="bottom-nav-item">
            <a href="/admin/dashboard" class="bottom-nav-link">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li class="bottom-nav-item">
            <a href="/admin/projects" class="bottom-nav-link">
                <i class="fas fa-project-diagram"></i>
                <span>Projects</span>
            </a>
        </li>
        <li class="bottom-nav-item">
            <a href="/admin/tasks" class="bottom-nav-link">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </a>
        </li>
        <li class="bottom-nav-item">
            <a href="/admin/analytics" class="bottom-nav-link">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
        </li>
        <li class="bottom-nav-item">
            <a href="/admin/billing" class="bottom-nav-link active">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Billing</span>
            </a>
        </li>
        <li class="bottom-nav-item">
            <a href="/admin/users" class="bottom-nav-link">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </a>
        </li>
    </ul>
</nav>

<!-- Mobile Navigation JavaScript -->
<script src="/js/admin-mobile-nav.js"></script>

<script src="/js/admin-common.js"></script>
<script src="/js/admin-billing.js"></script>
</body>
</html>
