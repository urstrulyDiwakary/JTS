<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/jts-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/jts-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicons/jts-48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicons/jts-64.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/jts-96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/favicons/jts-128.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/jts-192.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/favicons/jts-256.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicons/jts-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180.png">
    <!-- Fallback -->
    <link rel="icon" type="image/png" href="/jts.png" />

    <title>Settings - Jesta Tech Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2563eb; --success: #10b981; --danger: #ef4444; --light-bg: #f3f4f6; --sidebar-bg: #4169E1; --hover-bg: #1e40af; --text-light: #ffffff; --text-dark: #1f2937; --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { height: 100%; }
        body { font-family: var(--font-family); background: var(--light-bg); height: 100%; }
        .sidebar { position: fixed; left: 0; top: 0; height: 100vh; width: 260px; background: var(--sidebar-bg); padding: 20px 0; transition: 0.3s; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { display: flex; align-items: center; justify-content: space-between; padding: 0 20px 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .logo { display: flex; align-items: center; gap: 12px; color: var(--text-light); font-size: 1.3rem; font-weight: 700; font-family: var(--font-family); white-space: nowrap; }
        .logo i { font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; justify-content: center; }
        .toggle-btn { background: none; border: none; color: var(--text-light); font-size: 1.2rem; cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; }
        .toggle-btn:hover { background: rgba(255,255,255,0.1); transform: scale(1.05); }
        .toggle-btn i { font-size: 1.2rem; }
        .nav-menu { list-style: none; padding: 15px 0; flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .nav-link { display: flex; align-items: center; gap: 15px; padding: 14px 20px; color: rgba(255,255,255,0.7); text-decoration: none; transition: 0.3s; font-size: 0.95rem; font-family: var(--font-family); margin: 0 10px; border-radius: 6px; font-weight: 500; }
        .nav-link:hover { background: var(--hover-bg); color: var(--text-light); }
        .nav-link.active { background: var(--hover-bg); color: var(--text-light); border-left: 4px solid var(--primary); padding-left: 16px; }
        .nav-link i { font-size: 1.1rem; width: 20px; text-align: center; display: flex; align-items: center; justify-content: center; }
        .main-content { margin-left: 260px; transition: 0.3s; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { background: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; flex-shrink: 0; gap: 20px; }
        .user-profile { display: flex; align-items: center; gap: 12px; cursor: pointer; position: relative; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; }
        .user-info h4 { font-size: 0.9rem; margin-bottom: 2px; }
        .user-info p { font-size: 0.75rem; color: #6b7280; }
        .profile-dropdown { position: absolute; top: 100%; right: 0; margin-top: 10px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .profile-dropdown.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .profile-dropdown::before { content: ''; position: absolute; top: -6px; right: 20px; width: 12px; height: 12px; background: white; transform: rotate(45deg); box-shadow: -2px -2px 4px rgba(0,0,0,0.05); }
        .dropdown-header { padding: 15px; border-bottom: 1px solid #e5e7eb; }
        .dropdown-header h4 { font-size: 0.95rem; margin-bottom: 3px; }
        .dropdown-header p { font-size: 0.8rem; color: #6b7280; }
        .dropdown-menu { list-style: none; padding: 8px 0; }
        .dropdown-menu li { padding: 0; }
        .dropdown-menu button { display: flex; align-items: center; gap: 12px; width: 100%; padding: 12px 15px; text-decoration: none; color: #1f2937; border: none; background: none; cursor: pointer; font-size: 0.9rem; transition: background 0.2s ease; text-align: left; }
        .dropdown-menu button:hover { background: #f3f4f6; }
        .dropdown-menu i { width: 18px; font-size: 1rem; color: #6b7280; }
        .dropdown-menu .logout-btn { color: #ef4444; }
        .dropdown-menu .logout-btn i { color: #ef4444; }
        .content { padding: 30px; }
        .page-title h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .breadcrumb { color: #6b7280; font-size: 0.9rem; margin-bottom: 30px; }
        .settings-container { display: grid; grid-template-columns: auto 1fr; gap: 25px; }
        .settings-menu { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); height: fit-content; width: fit-content; min-width: 180px; }
        .settings-menu-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px; white-space: nowrap; }
        .settings-menu-item:hover { background: var(--light-bg); }
        .settings-menu-item:last-child { margin-bottom: 0; }
        .settings-menu-item.active { background: var(--primary); color: white; }
        .settings-panel { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .panel-header { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e5e7eb; }
        .panel-header h2 { font-size: 1.5rem; margin-bottom: 5px; }
        .panel-header p { color: #6b7280; }
        .form-section { margin-bottom: 30px; }
        .form-section h3 { margin-bottom: 15px; font-size: 1.1rem; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; border: 1px solid #e5e7eb; border-radius: 8px; outline: none; font-size: 0.95rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: 0.4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e5e7eb; }
        .setting-item:last-child { border-bottom: none; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1e40af; }
        .btn-danger { background: var(--danger); color: white; }
        .danger-zone { border: 2px solid var(--danger); border-radius: 12px; padding: 20px; margin-top: 30px; }
        .danger-zone h3 { color: var(--danger); margin-bottom: 10px; }
    </style>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo"><span>Jesta Tech Solutions</span></div>
            <button class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        </div>
        <ul class="nav-menu">
            <li><a href="/admin/dashboard" class="nav-link"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
            <li><a href="/admin/forms" class="nav-link"><i class="fas fa-list-check"></i><span>Forms</span></a></li>
            <li><a href="/admin/projects" class="nav-link"><i class="fas fa-project-diagram"></i><span>Projects</span></a></li>
            <li><a href="/admin/tasks" class="nav-link"><i class="fas fa-tasks"></i><span>Tasks</span></a></li>
            <li><a href="/admin/analytics" class="nav-link"><i class="fas fa-chart-line"></i><span>Analytics</span></a></li>
            <li><a href="/admin/billing" class="nav-link"><i class="fas fa-file-invoice-dollar"></i><span>Billing</span></a></li>
            <li><a href="/admin/users" class="nav-link"><i class="fas fa-users"></i><span>Users</span></a></li>
        </ul>
    </aside>

    <main class="main-content" id="mainContent">
        <div class="top-bar">
            <h2>Settings</h2>
            <div style="display: flex; align-items: center; gap: 25px;">
                <i class="fas fa-bell" style="font-size: 1.3rem; color: #1f2937; cursor: pointer; transition: 0.3s;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#1f2937'" title="Notifications"></i>
                <i class="fas fa-cog" onclick="window.location.href='/admin/settings'" style="font-size: 1.3rem; color: #2563eb; cursor: pointer; transition: 0.3s;" onmouseover="this.style.transform='rotate(90deg)'" onmouseout="this.style.transform='rotate(0deg)'" title="Settings"></i>
                <div class="user-profile" id="userProfileBtn">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <h4 id="userName">User</h4>
                        <p id="userRole">Role</p>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-header">
                            <h4 id="dropdownUserName">User</h4>
                            <p id="dropdownUserEmail">user@example.com</p>
                        </div>
                        <ul class="dropdown-menu">
                            <li>
                                <button onclick="handleLogout()" class="logout-btn">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Logout</span>
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            </div>

            <div class="settings-container">
                <div class="settings-menu">
                    <div class="settings-menu-item active" data-panel="profile"><i class="fas fa-user"></i><span>Profile</span></div>
                    <div class="settings-menu-item" data-panel="company"><i class="fas fa-building"></i><span>Company</span></div>
                    <div class="settings-menu-item" data-panel="notifications"><i class="fas fa-bell"></i><span>Notifications</span></div>
                </div>

                <!-- Profile Panel -->
                <div class="settings-panel" id="profilePanel">
                    <div class="panel-header">
                        <h2>Profile Settings</h2>
                        <p>Manage your personal information and preferences</p>
                    </div>

                    <div class="form-section">
                        <h3>Personal Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" value="Admin" placeholder="Enter first name">
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" value="User" placeholder="Enter last name">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" value="admin@jestatech.com" placeholder="Enter email">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" value="+91 98765 43210" placeholder="Enter phone">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select>
                                    <option>Administrator</option>
                                    <option>Manager</option>
                                    <option>Developer</option>
                                </select>
                            </div>
                        </div>
                    </div>


                    <div class="form-section">
                        <h3>Preferences</h3>
                        <div class="setting-item">
                            <div>
                                <strong>Email Notifications</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Receive email notifications for important updates</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary">Save Changes</button>
                        <button class="btn" style="background: #e5e7eb;">Cancel</button>
                    </div>

                    <div class="danger-zone">
                        <h3>Danger Zone</h3>
                        <p style="color: #6b7280; margin-bottom: 15px;">Once you delete your account, there is no going back. Please be certain.</p>
                        <button class="btn btn-danger">Delete Account</button>
                    </div>
                </div>

                <!-- Company Panel -->
                <div class="settings-panel" id="companyPanel" style="display: none;">
                    <div class="panel-header">
                        <h2>Company Settings</h2>
                        <p>Manage your company information and details</p>
                    </div>

                    <div class="form-section">
                        <h3>Company Information</h3>
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input type="text" id="companyName" placeholder="Enter company name">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Company Email</label>
                                <input type="email" id="companyEmail" placeholder="company@example.com">
                            </div>
                            <div class="form-group">
                                <label>Company Phone</label>
                                <input type="tel" id="companyPhone" placeholder="+1 (555) 000-0000">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Company Website</label>
                            <input type="url" id="companyWebsite" placeholder="https://www.example.com">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Business Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tax ID / GST Number</label>
                                <input type="text" id="taxId" placeholder="Enter tax ID">
                            </div>
                            <div class="form-group">
                                <label>Registration Number</label>
                                <input type="text" id="regNumber" placeholder="Enter registration number">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Industry</label>
                            <select id="industry">
                                <option value="">Select Industry</option>
                                <option>Technology</option>
                                <option>Finance</option>
                                <option>Healthcare</option>
                                <option>Education</option>
                                <option>Manufacturing</option>
                                <option>Retail</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Company Address</h3>
                        <div class="form-group">
                            <label>Street Address</label>
                            <input type="text" id="companyStreet" placeholder="Enter street address">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" id="companyCity" placeholder="Enter city">
                            </div>
                            <div class="form-group">
                                <label>State / Province</label>
                                <input type="text" id="companyState" placeholder="Enter state">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Country</label>
                                <select id="companyCountry">
                                    <option>India</option>
                                    <option>United States</option>
                                    <option>United Kingdom</option>
                                    <option>Canada</option>
                                    <option>Australia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Postal Code</label>
                                <input type="text" id="companyPostalCode" placeholder="Enter postal code">
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary">Save Company Settings</button>
                        <button class="btn" style="background: #e5e7eb;">Cancel</button>
                    </div>
                </div>

                <!-- Notifications Panel -->
                <div class="settings-panel" id="notificationsPanel" style="display: none;">
                    <div class="panel-header">
                        <h2>Notification Settings</h2>
                        <p>Manage how you receive notifications and updates</p>
                    </div>

                    <div class="form-section">
                        <h3>Notification Channels</h3>
                        <div class="setting-item">
                            <div>
                                <strong>Email Notifications</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Receive email notifications for important updates and activities</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div>
                                <strong>Push Notifications</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Receive push notifications in your browser</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div>
                                <strong>SMS Notifications</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Receive SMS alerts for critical events</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="smsNotifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Email Preferences</h3>
                        <div class="setting-item">
                            <div>
                                <strong>Project Updates</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Get notified about project status changes</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="projectUpdates" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div>
                                <strong>Task Assignments</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Get notified when tasks are assigned to you</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="taskAssignments" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div>
                                <strong>Comments & Mentions</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Get notified when someone mentions you or comments</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="commentsNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div>
                                <strong>Billing Updates</strong>
                                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 3px;">Get notified about invoice and payment updates</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="billingNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Report Frequency</h3>
                        <div class="form-group">
                            <label>Summary Report</label>
                            <select id="reportFrequency">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="never">Never</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary">Save Notification Settings</button>
                        <button class="btn" style="background: #e5e7eb;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/admin-common.js"></script>
    <script>
        // Settings state
        let currentSettings = null;
        let currentPanel = 'profile';

        // Toggle sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('mainContent').classList.toggle('expanded');
        }

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Settings page loaded');
            await loadSettings();
            setupEventListeners();
        });

        // Load settings from API
        async function loadSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                if (response.ok) {
                    currentSettings = await response.json();
                    console.log('Settings loaded:', currentSettings);
                    populateFormFields();
                    showToast('Settings loaded successfully', 'success');
                } else {
                    console.log('No existing settings, using defaults');
                    createDefaultSettings();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                createDefaultSettings();
            }
        }

        // Create default settings
        function createDefaultSettings() {
            currentSettings = {
                firstName: 'Admin',
                lastName: 'User',
                email: 'admin@jestatech.com',
                phone: '+91 98765 43210',
                role: 'Administrator',
                country: 'India'
            };
            populateFormFields();
        }

        // Populate form fields with current settings
        function populateFormFields() {
            if (!currentSettings) return;

            // Profile fields
            const firstNameInput = document.querySelector('input[placeholder="Enter first name"]');
            const lastNameInput = document.querySelector('input[placeholder="Enter last name"]');
            const emailInput = document.querySelector('input[type="email"]');
            const phoneInput = document.querySelector('input[type="tel"]');
            const roleSelect = document.querySelector('select');

            if (firstNameInput) firstNameInput.value = currentSettings.firstName || 'Admin';
            if (lastNameInput) lastNameInput.value = currentSettings.lastName || 'User';
            if (emailInput) emailInput.value = currentSettings.email || 'admin@jestatech.com';
            if (phoneInput) phoneInput.value = currentSettings.phone || '+91 98765 43210';
            if (roleSelect && currentSettings.role) {
                roleSelect.value = currentSettings.role;
            }

            // Toggle switches
            const toggles = document.querySelectorAll('.toggle-switch input[type="checkbox"]');
            if (toggles[0]) toggles[0].checked = currentSettings.emailNotifications !== false;

            // Company fields
            const companyNameInput = document.getElementById('companyName');
            const companyEmailInput = document.getElementById('companyEmail');
            const companyPhoneInput = document.getElementById('companyPhone');
            const companyWebsiteInput = document.getElementById('companyWebsite');
            const taxIdInput = document.getElementById('taxId');
            const regNumberInput = document.getElementById('regNumber');
            const industrySelect = document.getElementById('industry');
            const companyStreetInput = document.getElementById('companyStreet');
            const companyCityInput = document.getElementById('companyCity');
            const companyStateInput = document.getElementById('companyState');
            const companyCountrySelect = document.getElementById('companyCountry');
            const companyPostalCodeInput = document.getElementById('companyPostalCode');

            if (companyNameInput) companyNameInput.value = currentSettings.companyName || '';
            if (companyEmailInput) companyEmailInput.value = currentSettings.companyEmail || '';
            if (companyPhoneInput) companyPhoneInput.value = currentSettings.companyPhone || '';
            if (companyWebsiteInput) companyWebsiteInput.value = currentSettings.companyWebsite || '';
            if (taxIdInput) taxIdInput.value = currentSettings.taxId || '';
            if (regNumberInput) regNumberInput.value = currentSettings.registrationNumber || '';
            if (industrySelect && currentSettings.industry) industrySelect.value = currentSettings.industry;
            if (companyStreetInput) companyStreetInput.value = currentSettings.companyStreet || '';
            if (companyCityInput) companyCityInput.value = currentSettings.companyCity || '';
            if (companyStateInput) companyStateInput.value = currentSettings.companyState || '';
            if (companyCountrySelect && currentSettings.companyCountry) companyCountrySelect.value = currentSettings.companyCountry;
            if (companyPostalCodeInput) companyPostalCodeInput.value = currentSettings.companyPostalCode || '';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Panel switching
            const menuItems = document.querySelectorAll('.settings-menu-item');
            menuItems.forEach((item, index) => {
                item.addEventListener('click', function() {
                    // Remove active class from all menu items
                    menuItems.forEach(mi => mi.classList.remove('active'));
                    this.classList.add('active');

                    // Get the panel to show
                    const panels = ['profile', 'company', 'notifications'];
                    currentPanel = panels[index];

                    // Hide all panels
                    document.getElementById('profilePanel').style.display = 'none';
                    document.getElementById('companyPanel').style.display = 'none';
                    document.getElementById('notificationsPanel').style.display = 'none';

                    // Show the selected panel
                    if (currentPanel === 'profile') {
                        document.getElementById('profilePanel').style.display = 'block';
                    } else if (currentPanel === 'company') {
                        document.getElementById('companyPanel').style.display = 'block';
                    } else if (currentPanel === 'notifications') {
                        document.getElementById('notificationsPanel').style.display = 'block';
                    }

                    showToast(`Switched to ${this.textContent.trim()} panel`, 'info');
                });
            });

            // Save button
            const saveBtn = document.querySelector('.btn-primary');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveSettings);
            }

            // Cancel button
            const cancelBtn = document.querySelector('.btn[style*="background: #e5e7eb"]');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    populateFormFields();
                    showToast('Changes discarded', 'info');
                });
            }

            // Delete account button
            const deleteBtn = document.querySelector('.btn-danger');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', confirmDeleteAccount);
            }

            // Toggle switches
            const toggles = document.querySelectorAll('.toggle-switch input[type="checkbox"]');
            toggles.forEach((toggle, index) => {
                toggle.addEventListener('change', function() {
                    const labels = ['Email Notifications'];
                    console.log(`${labels[index]} ${this.checked ? 'enabled' : 'disabled'}`);
                });
            });
        }

        // Save settings
        async function saveSettings() {
            const firstNameInput = document.querySelector('input[placeholder="Enter first name"]');
            const lastNameInput = document.querySelector('input[placeholder="Enter last name"]');
            const emailInput = document.querySelector('input[type="email"]');
            const phoneInput = document.querySelector('input[type="tel"]');
            const roleSelect = document.querySelector('select');

            const toggles = document.querySelectorAll('.toggle-switch input[type="checkbox"]');

            const updateData = {
                firstName: firstNameInput?.value || '',
                lastName: lastNameInput?.value || '',
                email: emailInput?.value || '',
                phone: phoneInput?.value || '',
                role: roleSelect?.value || '',
                emailNotifications: toggles[0]?.checked || false
            };

            try {
                let url = '/api/admin/settings';
                let method = 'POST';

                if (currentSettings && currentSettings.id) {
                    url = `/api/admin/settings/${currentSettings.id}`;
                    method = 'PUT';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                if (response.ok) {
                    currentSettings = await response.json();
                    showToast('Settings saved successfully!', 'success');
                    console.log('Settings saved:', currentSettings);
                } else {
                    showToast('Failed to save settings', 'error');
                    console.error('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error saving settings. Please try again.', 'error');
            }
        }

        // Confirm delete account
        function confirmDeleteAccount() {
            if (confirm('⚠️ WARNING: This action cannot be undone!\n\nAre you absolutely sure you want to delete your account?')) {
                const confirmText = prompt('Type "DELETE" to confirm account deletion:');
                if (confirmText === 'DELETE') {
                    deleteAccount();
                } else {
                    showToast('Account deletion cancelled', 'info');
                }
            }
        }

        // Delete account
        async function deleteAccount() {
            try {
                showToast('Account deletion initiated...', 'warning');

                // In a real implementation, you would call the delete API
                // await fetch('/api/admin/settings/delete-account', { method: 'DELETE' });

                setTimeout(() => {
                    showToast('Account deleted. Redirecting to login...', 'success');
                    setTimeout(() => {
                        window.location.href = '/admin/login';
                    }, 2000);
                }, 1500);
            } catch (error) {
                console.error('Error deleting account:', error);
                showToast('Failed to delete account', 'error');
            }
        }

        // Toast notification function (if not in admin-common.js)
        function showToast(message, type = 'info') {
            // Check if showToast exists in admin-common.js
            if (typeof window.showToast === 'function') {
                window.showToast(message, type);
                return;
            }

            // Fallback toast implementation
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;

            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#2563eb'
            };

            toast.style.background = colors[type] || colors.info;
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
